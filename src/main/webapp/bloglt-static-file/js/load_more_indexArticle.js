$(function(){load_short(100,5)});function load_short(wordCounts,replaceCounts){var shortdata=document.getElementsByClassName("short-data").length;var start=shortdata-1;var end=start-replaceCounts;for(start;start>end;--start){var full_child=$(".full-data").eq(start).children();var full_child_length=full_child.length;var char_length=0;var short_child=$(".short-data").eq(start);for(var i=0;i<full_child_length;++i){var child=full_child.eq(i);var tagName=child[0].tagName;if(tagName=="P"){char_length+=full_child.eq(i).text().length;if(char_length>wordCounts){short_child.append(child);short_child.append("......");break}short_child.append(child)}else{if(tagName=="PRE"){char_length+=full_child.eq(i).text().length;short_child.append(child);short_child.append("......");break}else{char_length+=full_child.eq(i).text().length;if(char_length>wordCounts){short_child.append(child);short_child.append("......");break}short_child.append(child)}}}$(".short-data pre code").each(function(i,block){hljs.highlightBlock(block)})}}var flag=true;$(".load-more").click(function(){if(flag){flag=false;$(".load-more").text("( *・ω・)✄╰ひ╯,呀吼！正在加载哩...");var href=$(".article_more").last().attr("href");var param="articleId="+href.match(/articleId=(\S*)(&)?/)[1];$.ajax({type:"GET",url:"/loadmore",data:param,success:function(data){var jqObject=$(data);var data_length=0;var origin_data_length=jqObject.length;for(var i=0;i<origin_data_length;++i){if(jqObject[i].tagName=="DIV"){++data_length}}console.log(data_length);if(data_length==5){setTimeout(function(){$("#body").append(data);$(".load-more").text("加载更多...");load_short(100,data_length);flag=true},400)}else{setTimeout(function(){$("#body").append(data);$(".load-more").text("没有更多喽...-________-''");load_short(100,data_length)},400)}}})}});